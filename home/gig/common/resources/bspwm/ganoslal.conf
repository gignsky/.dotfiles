#!/bin/bash
# Ganoslal: 4-monitor dual-NVIDIA configuration  
# Hardware: RTX 3060 Ti (card0) + GTX 970 (card1)
#
# Hardware Layout:
#   RTX 3060 Ti (card0): DP-4, DP-5, HDMI-A-2
#   GTX 970 (card1): DP-1 (GTX970 monitor in top center)
#
# Physical Monitor Layout:
#   [HDMI-A-2] [DP-1*] [DP-4]    ← Top row (RTX + GTX970 center + RTX)
#        [DP-5]                  ← Bottom (Main big monitor)
#
# Desktop Distribution (Your preference: main first, left-to-right top, excess on main):
#   • Main Monitor (DP-5): I, II, III, IV, IX, X, XI, XII    (Primary + excess workspaces)
#   • Top-left (HDMI-A-2): V, VI                             (Secondary)  
#   • GTX970 center (DP-1): VII, VIII                        (GTX970 monitor)
#   • Top-right (DP-4): -                                    (Reserved for future use)

echo "Loading ganoslal 4-monitor dual-NVIDIA configuration..."

# Detect available monitors
AVAILABLE_MONITORS=$(xrandr --listmonitors 2>/dev/null | grep -v "Monitors:" | awk '{print $4}' || true)
echo "Available monitors: $AVAILABLE_MONITORS"

# Main monitor gets primary workspaces + excess (I-IV, IX-XII)
if echo "$AVAILABLE_MONITORS" | grep -q "DP-5"; then
    bspc monitor DP-5 -d I II III IV IX X XI XII
    echo "Configured main monitor DP-5 with workspaces I-IV, IX-XII (primary + excess)"
fi

# Top-left monitor (secondary workspaces)
if echo "$AVAILABLE_MONITORS" | grep -q "HDMI-A-2"; then
    bspc monitor HDMI-A-2 -d V VI  
    echo "Configured top-left HDMI-A-2 with workspaces V-VI"
fi

# GTX970 center monitor (your preference for center position)
if echo "$AVAILABLE_MONITORS" | grep -q "DP-1"; then
    bspc monitor DP-1 -d VII VIII
    echo "Configured GTX970 center DP-1 with workspaces VII-VIII"
fi

# Top-right monitor (reserved, will be auto-configured if connected)
if echo "$AVAILABLE_MONITORS" | grep -q "DP-4"; then
    # Keep DP-4 available but no dedicated workspaces (fallback will handle)
    echo "DP-4 detected but reserved for future workspace assignment"
fi

# Fallback for any unrecognized monitors
for monitor in $AVAILABLE_MONITORS; do
    if ! bspc query -M --names | grep -q "^$monitor$"; then
        echo "Configuring fallback monitor: $monitor"
        bspc monitor "$monitor" -d "FB$(echo $monitor | tr -d '-')"
    fi
done

CONFIGURED_MONITORS=$(bspc query -M --names | wc -l)
TOTAL_DESKTOPS=$(bspc query -D --names | wc -l)

echo "Ganoslal 4-monitor dual-NVIDIA setup complete:"
echo "  Monitors configured: $CONFIGURED_MONITORS"  
echo "  Total desktops: $TOTAL_DESKTOPS"
echo "  Target: RTX 3060 Ti (3 monitors) + GTX 970 (1 monitor)"
echo "  Layout: Main monitor has primary + excess workspaces"
