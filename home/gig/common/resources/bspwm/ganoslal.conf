#!/bin/bash
# Ganoslal: 4-monitor dual-NVIDIA configuration  
# Hardware: RTX 3060 Ti (card0/GPU 1) + GTX 970 (card1/GPU 0)
#
# X11 RandR Output Names:
#   RTX 3060 Ti (card0): HDMI-1-0, DP-1-1, DP-1-2
#   GTX 970 (card1): DP-1
#
# Physical Monitor Layout:
#   [HDMI-1-0] [DP-1] [DP-1-1]    ← Top row (all 1080p@60Hz)
#        [DP-1-2]                 ← Bottom (Main 1440p@120Hz, centered under DP-1)
#
# Desktop Distribution:
#   • Main Monitor (DP-1-2): I, II, III, IV, IX, X, XI, XII    (Primary + excess workspaces)
#   • Top-left (HDMI-1-0): V, VI                               (Secondary)  
#   • GTX970 center (DP-1): VII, VIII                          (GTX970 monitor)
#   • Top-right (DP-1-1): -                                    (Reserved for future use)

echo "Loading ganoslal 4-monitor dual-NVIDIA configuration..."

# Detect available monitors
AVAILABLE_MONITORS=$(xrandr --listmonitors 2>/dev/null | grep -v "Monitors:" | awk '{print $4}' || true)
echo "Available monitors: $AVAILABLE_MONITORS"

# Main monitor gets primary workspaces + excess (DP-1-2)
if echo "$AVAILABLE_MONITORS" | grep -q "DP-1-2"; then
    bspc monitor DP-1-2 -d I II III IV IX X XI XII
    echo "Configured main monitor DP-1-2 with workspaces I-IV, IX-XII (primary + excess)"
fi

# Top-left monitor (HDMI-1-0)
if echo "$AVAILABLE_MONITORS" | grep -q "HDMI-1-0"; then
    bspc monitor HDMI-1-0 -d V VI  
    echo "Configured top-left HDMI-1-0 with workspaces V-VI"
fi

# GTX970 center monitor (DP-1) - use exact match to avoid DP-1-x
if echo "$AVAILABLE_MONITORS" | grep -qE "^DP-1$|[[:space:]]DP-1[[:space:]]"; then
    bspc monitor DP-1 -d VII VIII
    echo "Configured GTX970 center DP-1 with workspaces VII-VIII"
fi

# Top-right monitor (DP-1-1) - reserved for future use
if echo "$AVAILABLE_MONITORS" | grep -q "DP-1-1"; then
    echo "DP-1-1 detected (reserved for future workspace assignment)"
fi

# Fallback for any unrecognized monitors
for monitor in $AVAILABLE_MONITORS; do
    if ! bspc query -M --names | grep -q "^$monitor$"; then
        echo "Configuring fallback monitor: $monitor"
        bspc monitor "$monitor" -d "FB$(echo $monitor | tr -d '-')"
    fi
done

CONFIGURED_MONITORS=$(bspc query -M --names | wc -l)
TOTAL_DESKTOPS=$(bspc query -D --names | wc -l)

echo "Ganoslal 4-monitor dual-NVIDIA setup complete:"
echo "  Monitors configured: $CONFIGURED_MONITORS"  
echo "  Total desktops: $TOTAL_DESKTOPS"
echo "  Target: RTX 3060 Ti (3 monitors) + GTX 970 (1 monitor)"
echo "  Layout: Main monitor (DP-1-2) centered under GTX970 (DP-1)"
