#!/bin/bash
# Merlin: Framework 16 laptop with optional external monitor support
#
# Physical Layout When Docked:
#   [Laptop Screen]  [External Monitor]
#        (eDP-1)         (right side)
#        Primary         Secondary
#
# Desktop Distribution:
#   Docked:   Laptop (I-VI) + External monitor (VII-X)
#   Portable: Single laptop screen (I-X)

echo "MERLIN DISPLAY DETECTION: Loading merlin Framework 16 configuration..."

# Check if external monitor exists
if xrandr | grep -q "DP.*connected\|HDMI.*connected"; then
  echo "MERLIN DISPLAY DETECTION: External monitor detected - setting up docked configuration"

  # Get the first connected external monitor
  EXTERNAL=$(xrandr | grep -E "DP.*connected|HDMI.*connected" | cut -d' ' -f1 | head -1)
  echo "MERLIN DISPLAY DETECTION: Found external monitor: $EXTERNAL"

  # Position external monitor to the right of laptop
  xrandr --output "$EXTERNAL" --right-of eDP-1 --auto

  # Set laptop as primary for main workflow
  xrandr --output eDP-1 --primary

  # Desktop distribution optimized for laptop-primary, external-secondary workflow
  bspc monitor eDP-1 -d I II VI VII VIII IX X # Main development (laptop)
  bspc monitor "$EXTERNAL" -d III IV V        # Secondary apps (external)

  echo "MERLIN DISPLAY DETECTION: Docked setup complete: Laptop (I-VI) + External monitor (VII-X)"

else
  echo "MERLIN DISPLAY DETECTION: No external monitor detected - setting up portable configuration"

  # Set laptop as primary for main workflow
  xrandr --output eDP-1 --primary

  # Portable: Single laptop screen
  bspc monitor eDP-1 -d I II III IV V VI VII VIII IX X

  echo "MERLIN DISPLAY DETECTION: Portable setup complete: Single screen (I-X)"
fi

echo "MERLIN DISPLAY DETECTION: Merlin Framework 16 bspwm setup complete"
